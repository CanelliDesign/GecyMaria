<!DOCTYPE html>
<html lang="pt-BR">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>Gecy Maria: Autobiografia</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin="">
    <link href="https://fonts.googleapis.com/css2?family=Lora:ital,wght@0,400..700;1,400..700&family=Inter:wght@400;700&family=Great+Vibes&display=swap" rel="stylesheet">
    
    <style>
        /* --- Configurações Globais --- */
        body {
            font-family: 'Lora', serif;
            background-color: #f0eadd;
            background-image: radial-gradient(#d6cbb3 1px, transparent 1px);
            background-size: 20px 20px;
            overflow: hidden;
            height: 100vh;
            display: flex;
            flex-direction: column;
            align-items: center;
            justify-content: center;
            -webkit-font-smoothing: antialiased;
            touch-action: pan-y; /* Permite scroll vertical, bloqueia horizontal nativo */
            
            /* Bloqueia seleção de texto para não atrapalhar o arrasto */
            -webkit-user-select: none;
            -moz-user-select: none;
            -ms-user-select: none;
            user-select: none;
        }

        /* --- Estrutura da Cena --- */
        .scene {
            width: 100%;
            height: 85vh;
            max-width: 1000px;
            perspective: 1500px;
            position: relative;
            margin: 0 auto;
        }

        .book {
            position: relative;
            width: 100%;
            height: 100%;
            transform-style: preserve-3d;
        }

        /* --- Estilo das Páginas --- */
        .page {
            position: absolute;
            width: 50%;
            height: 100%;
            top: 0;
            right: 0;
            transform-origin: left center;
            transform-style: preserve-3d;
            background-color: #FDFBF8; /* Cor de fundo base */
            border-radius: 0 10px 10px 0;
            box-shadow: inset 20px 0 50px rgba(0,0,0,0.05), -2px 0 5px rgba(0,0,0,0.1);
            cursor: grab;
            will-change: transform;
            /* Garante que a página seja visível */
            visibility: visible !important; 
            display: block !important;
        }
        
        .page.grabbing {
            cursor: grabbing;
        }

        /* Classe para ativar transição suave quando soltar a página */
        .page-transition {
            transition: transform 0.6s cubic-bezier(0.25, 1, 0.5, 1);
        }

        /* Conteúdo interno */
        .page-front {
            position: absolute;
            width: 100%;
            height: 100%;
            backface-visibility: hidden;
            -webkit-backface-visibility: hidden; /* Fix para Safari/iOS */
            padding: 40px;
            overflow: hidden; 
            background-color: #FDFBF8; /* Fundo sólido fallback */
            background-image: linear-gradient(to right, #e3dac9 0%, #FDFBF8 10%);
            z-index: 2;
        }

        /* Verso da página */
        .page-back {
            position: absolute;
            width: 100%;
            height: 100%;
            top: 0;
            left: 0;
            transform: rotateY(180deg);
            backface-visibility: hidden;
            -webkit-backface-visibility: hidden;
            background-image: linear-gradient(to left, #e3dac9 0%, #FDFBF8 10%);
            border-radius: 10px 0 0 10px;
            display: flex;
            align-items: center;
            justify-content: center;
            background-color: #f7f3e8;
            pointer-events: none;
            z-index: 1;
        }

        /* Sombra dinâmica */
        .page-shadow {
            position: absolute;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            pointer-events: none;
            background: linear-gradient(to right, rgba(0,0,0,0.4), transparent);
            opacity: 0;
            transition: opacity 0.2s;
            z-index: 10;
        }

        /* --- MODO MOBILE --- */
        @media (max-width: 768px) {
            .scene {
                perspective: 1200px;
                height: 80vh;
                max-width: 100%;
                padding: 10px;
            }

            .page {
                width: 95%;
                right: 2.5%;
                border-radius: 5px 15px 15px 5px;
            }
            
            .page-back {
                border-radius: 5px 15px 15px 5px;
            }

            .page-front {
                padding: 20px 20px 70px 20px;
            }
        }

        /* --- Estilos de Conteúdo --- */
        .capa {
            background-color: #7c2d12;
            color: white;
            display: flex;
            flex-direction: column;
            justify-content: center;
            align-items: center;
            text-align: center;
            border: 2px solid #551b08;
            background-image: url("data:image/svg+xml,%3Csvg width='100' height='100' viewBox='0 0 100 100' xmlns='http://www.w3.org/2000/svg'%3E%3Cpath d='M11 18c3.866 0 7-3.134 7-7s-3.134-7-7-7-7 3.134-7 7 3.134 7 7 7zm48 25c3.866 0 7-3.134 7-7s-3.134-7-7-7-7 3.134-7 7 3.134 7 7 7zm-43-7c1.657 0 3-1.343 3-3s-1.343-3-3-3-3 1.343-3 3 1.343 3 3 3zm63 31c1.657 0 3-1.343 3-3s-1.343-3-3-3-3 1.343-3 3 1.343 3 3 3zM34 90c1.657 0 3-1.343 3-3s-1.343-3-3-3-3 1.343-3 3 1.343 3 3 3zm56-76c1.657 0 3-1.343 3-3s-1.343-3-3-3-3 1.343-3 3 1.343 3 3 3zM12 86c2.21 0 4-1.79 4-4s-1.79-4-4-4-4 1.79-4 4 1.79 4 4 4zm28-65c2.21 0 4-1.79 4-4s-1.79-4-4-4-4 1.79-4 4 1.79 4 4 4zm23-11c2.76 0 5-2.24 5-5s-2.24-5-5-5-5 2.24-5 5 2.24 5 5 5zm-6 60c2.21 0 4-1.79 4-4s-1.79-4-4-4-4 1.79-4 4 1.79 4 4 4zm29 22c2.76 0 5-2.24 5-5s-2.24-5-5-5-5 2.24-5 5 2.24 5 5 5zM32 63c2.76 0 5-2.24 5-5s-2.24-5-5-5-5 2.24-5 5 2.24 5 5 5zm57-13c2.76 0 5-2.24 5-5s-2.24-5-5-5-5 2.24-5 5 2.24 5 5 5zm-9-21c1.105 0 2-.895 2-2s-.895-2-2-2-2 .895-2 2 .895 2 2 2zM60 91c1.105 0 2-.895 2-2s-.895-2-2-2-2 .895-2 2 .895 2 2 2zM35 41c1.105 0 2-.895 2-2s-.895-2-2-2-2 .895-2 2 .895 2 2 2zM12 60c1.105 0 2-.895 2-2s-.895-2-2-2-2 .895-2 2 .895 2 2 2z' fill='%239c4221' fill-opacity='0.1' fill-rule='evenodd'/%3E%3C/svg%3E");
        }

        .title-fancy { font-family: 'Great Vibes', cursive; }

        /* Scrollbar interna do conteúdo */
        .content-scroll {
            height: 100%;
            overflow-y: auto;
            padding-right: 10px;
            /* Permite scroll suave e nativo */
            -webkit-overflow-scrolling: touch; 
        }
        .content-scroll::-webkit-scrollbar { width: 4px; }
        .content-scroll::-webkit-scrollbar-track { background: transparent; }
        .content-scroll::-webkit-scrollbar-thumb { background: #d6cbb3; border-radius: 2px; }

        .page-number {
            position: absolute;
            bottom: 20px;
            width: 100%;
            text-align: center;
            font-size: 0.8rem;
            color: #888;
            left: 0;
            pointer-events: none;
        }

        /* Botões de Navegação - Setas Singelas */
        .nav-btn {
            position: fixed;
            top: 50%; /* Centralizado verticalmente por padrão (Desktop) */
            transform: translateY(-50%);
            background: transparent;
            color: #7c2d12;
            padding: 15px;
            border-radius: 50%;
            border: none;
            cursor: pointer;
            z-index: 200;
            display: flex;
            align-items: center;
            justify-content: center;
            opacity: 0.6; /* Leve transparência para ser sutil */
            transition: all 0.2s ease;
        }

        .nav-btn:hover { 
            opacity: 1;
            background: rgba(124, 45, 18, 0.05); /* Feedback sutil ao passar o mouse */
            transform: translateY(-50%) scale(1.1); 
        }
        
        .nav-btn:active { transform: translateY(-50%) scale(0.95); }

        .btn-prev { left: 10px; }
        .btn-next { right: 10px; }
        
        /* Desabilitado: some completamente para não atrapalhar */
        .btn-disabled { opacity: 0; pointer-events: none; } 

        /* Ajustes Mobile para as setas */
        @media (max-width: 768px) {
            .nav-btn {
                top: auto;
                bottom: 15px; /* No rodapé para fácil acesso */
                transform: none; /* Reset transform */
                opacity: 0.8;
                padding: 10px;
            }
            
            .nav-btn:hover {
                transform: scale(1.1);
                background: transparent;
            }
            
            .nav-btn:active { transform: scale(0.9); }
            
            .btn-prev { left: 20px; }
            .btn-next { right: 20px; }
            
            /* Seta um pouco maior para toque */
            .nav-btn svg { width: 40px; height: 40px; filter: drop-shadow(0 1px 2px rgba(255,255,255,0.8)); }
        }

        /* Indicador de progresso */
        .progress-bar {
            position: fixed;
            top: 0;
            left: 0;
            height: 4px;
            background: #7c2d12;
            transition: width 0.3s;
            z-index: 300;
        }
        
        /* Botão de Download */
        .btn-download {
            position: fixed;
            top: 15px;
            right: 15px;
            z-index: 300;
            background-color: rgba(255, 255, 255, 0.8);
            color: #7c2d12;
            width: 40px;
            height: 40px;
            border-radius: 50%;
            display: flex;
            align-items: center;
            justify-content: center;
            box-shadow: 0 2px 5px rgba(0,0,0,0.2);
            border: 1px solid #e3dac9;
            cursor: pointer;
            transition: all 0.2s;
        }
        .btn-download:hover {
            transform: scale(1.1);
            background-color: white;
        }
        .btn-download:active { transform: scale(0.95); }

    </style>
</head>
<body>

    <div id="progress" class="progress-bar" style="width: 0%"></div>

    <!-- Botão de Download -->
    <button class="btn-download" onclick="downloadBook()" title="Baixar para ver offline">
        <svg xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke-width="2" stroke="currentColor" class="w-6 h-6">
            <path stroke-linecap="round" stroke-linejoin="round" d="M3 16.5v2.25A2.25 2.25 0 005.25 21h13.5A2.25 2.25 0 0021 18.75V16.5M12 12.75l-3-3m0 0l3-3m-3 3h7.5M21 12a9 9 0 11-18 0 9 9 0 0118 0z" />
            <path stroke-linecap="round" stroke-linejoin="round" d="M12 15.75V3" />
        </svg>
    </button>

    <!-- Instruções -->
    <div class="fixed top-4 left-4 text-stone-600 text-xs md:text-sm font-bold z-50 bg-white/90 px-4 py-2 rounded-full shadow backdrop-blur-sm pointer-events-none select-none text-center">
        <span class="hidden md:inline">Arraste a folha para virar | Role o texto para ler</span>
        <span class="md:hidden">Arraste para os lados para virar<br>Arraste para cima para ler</span>
    </div>

    <!-- O Livro -->
    <div class="scene" id="scene-container">
        <div class="book" id="book">
            <!-- Páginas geradas via JS -->
        </div>
    </div>

    <!-- Controles Singelos (Setas) -->
    <button id="btn-prev" class="nav-btn btn-prev btn-disabled" aria-label="Página anterior">
        <svg xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke-width="2" stroke="currentColor" class="w-8 h-8 md:w-10 md:h-10">
            <path stroke-linecap="round" stroke-linejoin="round" d="M15.75 19.5L8.25 12l7.5-7.5" />
        </svg>
    </button>
    <button id="btn-next" class="nav-btn btn-next" aria-label="Próxima página">
        <svg xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke-width="2" stroke="currentColor" class="w-8 h-8 md:w-10 md:h-10">
            <path stroke-linecap="round" stroke-linejoin="round" d="M8.25 4.5l7.5 7.5-7.5 7.5" />
        </svg>
    </button>

    <script>
        const stories = [
            { id: 'capa', type: 'cover', title: 'Minha Vida', content: '' },
            { id: 'indice', type: 'index', title: 'Índice', content: '' },
            { id: 'intro', theme: 'inicio', title: 'Neste Pequeno Livro', content: `Neste pequeno livro, quero contar minha história. Tinha apenas quatro anos de idade quando comecei a me entender por gente. Meus pais moravam no interior, em um lindo lugar de Minas chamado Vale Verde. Éramos uma família que servíamos a Deus, e por isto, a gente era muito feliz.<br><br>Como é lindo lembrar daquele tempo de infância. Tudo era pureza e maravilha em volta de mim. Não tínhamos maldade, nem malícia, nem curiosidade pecaminosa.<br><br>Meus pais moravam num ranchinho de barro coberto de sapé, com lindas plantas em volta da casinha. Éramos uma família muito feliz. Dos cinco filhos de minha mãe, eu era a segunda. Tinha cinco anos de idade e gostava muito de adorar ao Senhor Jesus.<br><br>Nos fundos de minha casinha humilde, existia um pequeno riozinho muito lindo, com belas paisagens. Alamandas subiam por cima dos pés de ingás, abrindo suas lindas flores amarelas refletidas nas claras águas do riacho. Então eu me punha a meditar nas maravilhas do Senhor.<br><br>Gostava muito das historinhas da Bíblia, principalmente de Davi. Mamãe e papai faziam um cultinho com a família todas as manhãs. Cantávamos lindos corinhos, falávamos o texto áureo de cor e recitávamos o Salmo 23 e outros textos. Nós éramos muito obedientes aos nossos pais e ao Senhor Jesus, por isto éramos felizes.<br><br>Aos domingos, nossa mãe e nosso pai nos levavam à Escola Dominical numa igrejinha à beira da estrada. Ela era muito linda porque o Senhor Jesus estava lá para nos ensinar a amá-lo, e também a amar a mamãe, o papai, os amigos e até os inimigos. Aprendíamos lindos corinhos com a nossa professora, tia Dulce.` },
            { id: 'passaros', theme: 'inicio', title: 'O Canto dos Pássaros e a Poeira da Estrada', content: `Foi por volta de 1961 que aconteceu este fato. Minha família era constituída de oito pessoas: meu irmão mais velho, de 10 anos; minha irmãzinha caçula, de 2 anos de vida; e minha querida mãe, que estava prestes a dar à luz o sétimo filho.<br><br>O cantinho onde morávamos era super aconchegante! Muito verde, muitas águas cristalinas, muitas estradas empoeiradas... Características do sertão da nossa querida Minas Gerais. Também não posso deixar de fazer menção aos lindos pássaros a cantar entre as lindas e imponentes árvores que rodeavam a nossa humilde casa. Havia pássaros voantes, como havia muitos pássaros andantes. Todos, em sintonia, formavam um lindo coral! Uma orquestra sem instrumentos cujo regente era o Criador de todas as coisas.<br><br>Mas os encantos não paravam por aí. Nossa querida mãe, que ainda vive, gostava muito de nos levar à casa de nossas tias para passear. Oh, como era agradável! Andávamos muitos quilômetros a pé, pois não existiam meios de transportes como há nas grandes e pequenas cidades. Mas, para nós, o andar a pé era o nosso lazer, pois íamos pelas empoeiradas estradas brincando de esconder.<br><br>Nada naquele lindo e simples lugar nos oferecia perigo; vivíamos uma vida da mais pura inocência. De vez em quando, passava por nós na estrada um carro de boi. Sei que existem muitas pessoas que não sabem o que é um carro de boi... Um carro de boi é uma carroça gigante puxada por bois, o meio de transporte do interior dos estados do Brasil. A nossa alegria e euforia era quando ouvíamos o cantar das rodas desse carro em meio à poeira a voar para cima. Tudo era pura diversão.<br><br>Assim caminhávamos pelas empoeiradas estradas do nosso sertão! À beira da estrada, lindas flores campestres pareciam dar-nos boas-vindas! Suas fragrâncias enchiam o ar de puro amor. Chegando na casa de nossa tia, tudo o que queríamos era descansar, mas para isso acontecer, tínhamos que lavar os pés. Depois, tomar aquele café com leite e comer broa de fubá com manteiga produzida na fazenda da nossa tia. Oh, o quanto isso era lindo e divertido! Tenho muitas saudades daqueles tempos! Embora eu saiba que eles não voltam mais, dá-me a impressão de que eu ainda os vivo.` },
            { id: 'susto', theme: 'sustos', title: 'Um Grande Susto', content: `Um dia, nosso pai saiu para trabalhar numa mata no alto de uma serra ou montanha. Enquanto isto, mamãe cuidava da casa, e nós brincávamos despreocupadamente, em meio a tanta inocência e pureza. Quando, de repente, escutamos todas as galinhas se espantarem e gritar, ficamos com muito medo. Então, mamãe veio correndo e viu uma enorme cobra que media três metros de comprimento.<br><br>Nós corremos para junto de mamãe, agarramos em seus vestidos e começamos a orar, pedindo ao Papai do Céu que nos livrasse daquela grande cobra. Foi então que Deus trouxe o nosso pai. Ele nos acalmou e nos protegeu, porque Deus estava conosco. Assim, papai matou aquela cobra, e nós voltamos a brincar.` },
            { id: 'cura', theme: 'sustos', title: 'O Irmão Curado', content: `Meu irmão mais novo tinha quatro anos. Um dia, ele estava brincando debaixo de um fogão de lenha, quando de repente, ele caiu para trás. Mamãe, quando o viu, achou que he estava dormindo, mas quando olhou direito, viu que ele estava desmaiado. Então, mamãe começou a gritar e a chamar meu pai, que estava no alto da montanha. Meu pai escutou e desceu correndo. Chegando em casa, pegou meu irmãozinho, olhou para o céu, orou a Deus, fez um voto, e Jesus o curou. E todos nós ficamos muito alegres. E nunca mais meu irmão ficou doente.` },
            { id: 'saudade', theme: 'inicio', title: 'Saudade de Minha Infância', content: `Era muito linda a vida no sertão. Certo dia, minha mãe saiu para fazer compras, chamou seus dois filhos mais velhos e disse: "Olha, não quero que vocês brinquem de polícia e ladrão, nem com fogo, nem de pular a janela, porque o Senhor Jesus fica triste, e o anjinho também". Mas nós não obedecemos à mamãe e brincamos com aquela brincadeira proibida. Quando mamãe chegou, nós levamos um susto muito grande. Sabe por quê? Porque mamãe nos batia com vara de guanxuma, e ela doía muito.<br><br>Então, nós pulamos a janela e saímos correndo no meio do matagal. Corremos, corremos, muito, muito, muito, até chegar à beira do rio.` },
            { id: 'rio', theme: 'sustos', title: 'Um Rio de Muitas Recordações', content: `Cansados de correr da mamãe, paramos à beira desse rio. Sentamos no chão para descansar nossas pernas. Enquanto isto, começamos a refletir sobre tudo o que tínhamos feito de errado e começamos a chorar. Fizemos uma oração, pedimos perdão ao Senhor Jesus. Sentadas no chão, duas inocentes crianças esperavam que alguém pudesse nos encontrar e nos trouxesse de volta para casa.<br><br>Era uma hora da tarde e começamos a ficar com muita fome. Pensávamos em voltar para casa, mas tínhamos medo de mamãe nos bater.<br><br>Às margens do rio havia um lindo pé de jenipapo com muitos frutos. Então eu disse para meu irmão: "Vamos apanhar jenipapos para nós comermos?". O meu irmão me retrucou: "Como apanharemos? A árvore é muito alta e nós somos pequeninos". Então, começamos a atirar pedras na árvore e os frutos começaram a cair. Pegamos os jenipapos, começamos a comer e bebemos água do rio.<br><br>De repente, um susto! Em meio à quebra do silêncio que fazia naquela tarde no meio do mato, surgiu algo muito estranho. "Ai meu Deus, o que será isto? O que é que está acontecendo? Tenha dó de nós, Senhor Jesus, nos livra!". Ficamos a olhar. Parecia que o vento derrubava o mato em cima de nós. Continuamos a olhar e vimos uma enorme cobra que media três metros de comprimento. Nós ficamos parados diante daquele monstro. Naquele momento, nós só pensamos no Senhor Jesus. Ele mandou seus anjos para nos proteger.<br><br>Assim como Davi matou o gigante Golias, Ele também nos deu força. Eu, com apenas seis anos, e meu irmão, sete anos, começamos a atirar pedras naquela cobra, assim como Davi atirou em Golias. E nós matamos aquela cobra com toda a nossa força. Depois, ficamos sentados ao lado dela, pensando o que fazer.<br><br>Começamos a pensar como iríamos voltar para casa. "Será que mamãe ainda iria nos bater? Será que ela tinha esquecido tudo? Será que ela iria nos perdoar?".<br><br>Foi então que, na nossa astúcia, pensamos em surpreender mamãe, levando aquela cobra como troféu da nossa vitória. Pois pensávamos assim: "Quando mamãe nos ver com esta cobra, ela vai ficar impressionada com o livramento que o Senhor nos deu, que ela nem vai lembrar de nos bater".<br><br>Então, pusemos o nosso plano em prática. Pegamos cipó no mato, amarramos na cabeça da cobra e começamos a puxar aquela cobra pelas campinas verdejantes. E assim fomos, até chegar perto do terreiro da nossa casa. Quando avistamos mamãe, nós paramos e começamos a chorar. Mamãe nos viu de longe e viu que estávamos puxando alguma coisa.<br><br>Foi então que ela chamou nosso pai e disse: "Eliezer, as crianças vêm vindo pelo campo, puxando alguma coisa esquisita. O que será aquilo?". Eliezer respondeu: "Não sei, mas vamos encontrar com elas pra ver o que é".<br><br>Assim, eles foram ao nosso encontro. Quando eles se aproximaram de nós e viram aquela enorme cobra, ficaram muito assustados. E, ao invés de nos bater, eles nos abraçaram, choraram e agradeceram a Jesus por ter nos dado tão grande livramento. Em seguida, nos levaram para dentro de casa, leram a Bíblia conosco, nos aconselharam e fizemos uma oração, agradecendo a Deus por tão grande livramento.<br><br>Aí, nós pedimos perdão à mamãe e ao papai e prometemos nunca mais brincar de polícia e ladrão. Pois a nossa brincadeira de criança tem que ser santa. Podemos brincar imitando Davi, Samuel, Sansão, Moisés e o menino Jesus quando tinha 12 anos e ensinava os doutores da Lei.` },
            { id: 'cachorro', theme: 'sustos', title: 'O Cachorro Amarelo', content: `Numa noite de lua muito clara, Eliezer e Zima foram caçar tatu e deixaram seus quatro filhos dormindo, todos num só quarto. Quando, de repente, apareceu dentro do quarto, no meio das crianças, um enorme cachorro amarelo. Ele tinha olhos vermelhos, dentões e um linguão vermelho. Quando as crianças o viram, todos começaram a gritar. Gritaram, gritaram, gritaram muito, mas aquele cachorro não saía do meio das crianças. Foi então que Eliezer e Zima escutaram os gritos das crianças e voltaram correndo para casa.<br><br>Eliezer pegou um machado, arrebentou a porta e deu um forte grito, e disse: "O que é isto, meninos?". Foi então que o cachorro desapareceu. Papai e mamãe nos abraçaram, oraram por nós e nós dormimos em paz, meditando no Salmo de número quatro, verso oito. E nunca mais nós vimos aquele cachorrão.` },
            { id: 'fogo', theme: 'sustos', title: 'O Fogo e a Marca', content: `Voltamos do passeio da casa da tia e a vida de roça seguiu. Aos 6 anos, não tínhamos muito tempo para brincar. Meu pai ensinou-nos a capinar o solo para retirar os matos e ervas daninhas do meio do feijão e do milho, e minha mãe me ensinou a cozinhar. Assim, nossa infância foi, em parte, vendida ao trabalho pesado.<br><br>Um dia, minha mãe me mandou fazer o almoço para ela. Eu tinha apenas 7 anos de vida, então obedeci e comecei a fazer. Quando fui preparar o feijão, algo muito triste aconteceu. As panelas da roça são de ferro e esquentam muito! Eu deixei aquela panela esquentar demais. Foi então que coloquei a gordura e, logo após, o alho. Aquela gordura entrou em combustão. Quando joguei o feijão, subiu um alto fogo da panela, e aquela gordura misturada com fogo caiu toda no meu braço esquerdo, abrindo assim três grandes brechas.<br><br>Gritei desesperadamente! Minha mãe também gritava, mas não tínhamos muito o que fazer. O lugar era um sertão bravo, não tínhamos nem um comprimido para aliviar a dor. Minha mãe colocou sabonete e picumã — picumã é um resíduo de fumaça misturada com gordura que acumula no telhado, por cima do fogão a lenha. Meu braço foi enrolado na folha de bananeira. Sofri muito.` },
            { id: 'adeus', theme: 'licoes', title: 'Adeus ao "Matão Bravo"', content: `Minha querida mãe cuidava de minhas feridas causadas pelas queimaduras. A dor era insuportável, mas minha mãe estava sempre ao meu lado nesses difíceis momentos. Foi então que minha querida e adorável tia foi passear na nossa casa. Ela não sabia que eu estava acidentada, pois naquele lugar, naquela época, não existia comunicação como nos dias atuais. O sistema era quase medieval: as mensagens eram levadas por correios ou por amigos de extrema confiança.<br><br>Quando ela me viu deitada na cama, assustou-se muito e ficou imensamente triste. Disse então para minha mãe e meu pai:<br>— Vou levar essa menina, minha sobrinha, para a cidade grande. Ela não pode continuar aqui desse jeito que está.<br><br>Meu pai e minha mãe relutavam, não querendo abrir mão de mim para ir fazer o tratamento em Governador Valadares. Enfim, minha tia conseguiu convencê-los. Fomos fazer os preparativos para a viagem. Foi a primeira vez que eu, uma criança de 7 anos, saía do matão bravo com direção a uma cidade grande! Dei adeus ao grotão onde morávamos, dei adeus à minha querida mãezinha, com muitas lágrimas e choro.<br><br>Assim partimos, eu e minha querida tia. E lá fomos nós, naquela empoeirada estrada de terra do meu querido, sofrido e imenso sertão do interior de Minas Gerais. Depois de andarmos três quilômetros, chegamos no estradão de terra onde passava um único ônibus por dia. Chamávamos aquela condução de "auto", porque éramos acostumados com carroças. Aquela condução nos transportou até uma cidade chamada Resplendor. Para mim era pura diversão, pois nunca tinha entrado em uma coisa daquelas; parecia uma casa com rodas!` },
            { id: 'resplendor', theme: 'licoes', title: 'As Águas de Resplendor e o Trem de Ferro', content: `A viagem durou duas horas até chegarmos a uma linda cidade chamada Resplendor — o seu nome já diz tudo: a beleza de Resplendor!<br><br>Nessa linda cidade vi muitas coisas maravilhosas. Eu era uma menina sertaneja de apenas 7 anos, mas muito observadora, apesar de ser retraída e gostar de privacidade. O encanto que me tirou o fôlego foi contemplar o grande Rio Doce, de águas cristalinas, que divide aquela cidade em duas partes. Nunca eu tinha visto um rio grande assim! O mais legal foi atravessar aquele rio numa embarcação chamada canoa, pois nem em sonho pensava eu que existia tal embarcação. Do outro lado ficava o hotel onde iríamos passar a noite, pois no dia seguinte, ao amanhecer, seguiríamos viagem rumo a Governador Valadares.<br><br>Assim que o dia raiou, levantamos. O que contemplei me tirou o fôlego! Do terceiro andar daquele hotel, vi os raios de sol refletirem sobre as águas claras do Rio Doce. Não era um sonho, não era uma ilusão, eu estava vivendo no sentido físico tudo aquilo.<br><br>Então a tia me disse:<br>— Vamos tomar um cafezinho antes de partir.<br><br>Assentamos à mesa e tomamos aquele café com leite de Resplendor. Isso para mim não tinha preço, pois foi a primeira vez na vida que tal coisa acontecia. Acabando de tomar o café, pegamos nossas malas e saímos em direção à plataforma de embarque. Entramos no barco e voltamos para a outra banda do Rio Doce. Aquelas águas claras e lindas de se ver nunca saíram da minha mente.<br><br>Demos um "até breve" a Resplendor. Então, surge outro meio de transporte chamado trem! Nunca tinha visto isso antes na minha vida, quanto mais viajar numa coisa dessas. Foi então que o tal do trem chegou. Deu um apito forte! Levei um susto grande, segurei no vestido da tia, arregalei os olhos e tremi de medo.<br>A tia disse:<br>— Não precisa ficar com medo! O trem faz essas coisas mesmo, mas não machuca ninguém.<br><br>Entramos no trem e nos assentamos. Era muita gente, e eu não tinha costume de ficar em meio a tanta gente; era muito tímida e retraída. Então abaixei minha cabeça e só a levantei quando chegamos a Governador Valadares.` },
            { id: 'cidade', theme: 'licoes', title: 'Luzes e Sombras da Cidade Grande', content: `Ao chegarmos naquela cidade, desembarcamos do trem olhando sempre para trás. Fiquei com muito medo, pois era a primeira vez que via um montão de gente assim; isso me apavorou de verdade. Minha tia dizia:<br>— Minha filha, não fique olhando para trás, as pessoas vão pensar que você é uma menina da roça.<br><br>Mas eu era uma criança sertaneja, isso ninguém podia negar! Fomos andando pelas ruas daquela linda cidade de Governador Valadares. Meu bracinho acidentado estava envolto em um pano branco com sumo de assa-peixe (uma planta anti-inflamatória usada na roça onde não há recursos médicos). O poder dessa planta é muito eficaz, mas o tratamento da queimadura ali precisava ser diferenciado. Aquele pano com o sumo havia agarrado todo em meu machucado. Tia passou comigo em uma farmácia para fazer a limpeza e o curativo. Foi um grito de morte! Como doeu! Tia teve que me segurar bem firme. Oh, o quanto eu sofri!<br><br>Compensando o sofrimento, saímos da farmácia e fomos a um restaurante para nos alimentar. Íamos caminhando, e eu me punha a olhar para trás, esquecendo-me do alerta da tia. Eu já estava exausta quando algo me chamou muito a atenção. Até então eu não havia olhado para cima; quando fiz isso, fiquei aterrorizada! Apontei o dedinho para cima e perguntei:<br>— O que é aquilo, tia?<br><br>Ela abaixou a minha mãozinha e disse:<br>— Não aponte e nem olhe para cima, as pessoas vão pensar que você é uma menina da roça.<br><br>Mas o show estava só começando. Os prédios eram altos, nunca tinha visto aquilo antes; era tudo novo para mim. Depois de ter dado a primeira voltinha no centro da cidade, fui conhecer a casa da tia. Achei tudo muito lindo e diferente de nossa humilde casa na roça. Fiquei maravilhada, agora era só questão de me adaptar aos costumes e às novas regras impostas pela minha tia, que ficou no lugar de minha mãe.` },
            { id: 'gatos', theme: 'licoes', title: 'Gatos, Charretes e Pirolitos', content: `Enquanto eu me adaptava, minha tia continuava com o tratamento de minhas queimaduras. Eram muito dolorosas, mas eu suportava porque queria ficar curada logo. Enfim, acabou o tratamento médico! Agora eu podia brincar, podia correr atrás dos gatos!<br><br>Havia muitos gatos, eram dos vizinhos, mas muito engraçados e diferentes dos gatos da minha roça. Ao anoitecer, eles faziam uma reunião entre eles para tratar de alguns "negócios". Não me pergunte o que era, pois não tenho resposta a esse enigma! Só sei que, em dado momento daquela reunião, eles divergiam uns dos outros e aí o pau quebrava. Era tapa pra lá, tapa pra cá, gritos... E assim passávamos noites acordados. Minha tia por vezes saía lá fora com um porrete na mão, mas eles corriam feito uma lebre. Essa foi a parte engraçada que se passou comigo naquela cidade.<br><br>Quero mencionar aqui que nós éramos cristãos evangélicos e, todos os domingos, minha tia me levava à Escola Bíblica Dominical. Isso para mim não tinha preço! Saíamos rumo à igreja e, ao chegarmos na rua, minha tia me surpreendeu novamente com uma condução que eu nunca imaginava existir: a Charrete.<br><br>Afinal de contas, o que é uma charrete? É uma carroça projetada para conduzir três pessoas, de tração animal (cavalo). Ela é muito confortável, o seu banco de passageiros se equipara a um banco de Fusca. É toda coberta por um tecido semelhante a lona ou tecido de sombrinha colorida; muito chique e elegante! As charretes eram usadas como táxi.<br><br>Ao chegarmos na praça central, descemos, minha tia pagou a passagem e o charreteiro foi embora. Levantei a cabeça e olhei: diante de mim estava um majestoso templo cristão! Nunca imaginei que pudesse existir uma igreja tão grande. Fiquei deslumbrada com a beleza e a altura daquele templo. Era dezembro, véspera de Natal. No pináculo da igreja tinha uma corneta, a qual tocava louvores, espalhando lindas melodias de Natal sobre a cidade. Nós, as crianças, decorávamos lindas poesias que traduziam o verdadeiro Espírito do Natal. Até hoje, aos 73 anos, ainda me lembro e recito aquelas poesias. O tempo é incapaz de apagar do meu coração coisas tão significantes.<br><br>Eu não sabia ler, nem conhecia nenhuma letra do abecedário, mas minha tia, com muita paciência e amor, me alfabetizou através da leitura da Bíblia Sagrada. Foram momentos ímpares na minha vida!<br><br>Também aprendi a fazer balas e "pirolitos" (pirulitos). As balas eram em formato de chupetas de bebê. Ficava eu na porta da casa da minha tia gritando: "Ó O PIROLITO! Ó O PIROLITO!". Esse era o meu digno trabalho de menina de 7 anos.<br><br>Tinha também meus momentos de lazer, muito preciosos. Ao lado da casa da tia passava o trem, e a 100 metros da linha, o exuberante Rio Doce descia mansamente com suas águas claras, serpenteando a imponente Ibituruna, de 1.123 metros de altura. Tive o privilégio de desfrutar de todas essas belezas naturais! Hoje, junto à pedra Ibituruna, foi construído o maior edifício de todo o Estado de Minas Gerais. Mas as minhas memórias continuam sendo o alicerce mais alto que conheço.` },
            { id: 'argentino', theme: 'licoes', title: 'O Menino Argentino', content: `Há muito tempo, morávamos num lindo lugar de nome **Vale Verde**. Neste lugar, havia lindos pomares de frutas, lagoas com muitas taboas e lindas saracuras. Gostávamos de correr atrás delas, só não conseguíamos pegá-las porque elas eram muito rápidas.<br><br>Foi então que ouvimos alguém passando na empoeirada estradinha. Aí, nós corremos para a beira da estrada para ver quem era. Foi então que vimos um menino sujo e maltrapilho. Ele se assustou conosco, e também nos assustamos com ele. Ficamos parados sem falar um com o outro, porque éramos muito tímidos, mas isso é próprio de crianças da roça. De repente, quebramos o silêncio e perguntamos: "Quem é você?".<br><br>E ele respondeu: "Eu não vou falar meu nome. Sou argentino, tenho onze anos e estou com fome".<br><br>"Vocês moram aqui?"<br><br>"Sim, moramos. Meu nome é Jaidi, minha irmã é Deey, minha mãe é Zima. Vamos para minha casa. Minha mãe é boazinha, ela vai te dar comida, café, biscoitos e muitas coisas boas".<br><br>Quando o argentino chegou lá em casa, nossa mãe ficou assustada e perguntou a nós: "Que menino é esse, Jaidinho?". Nós dissemos para a mamãe que ele se chamava Argentino e não sabia falar bem a nossa língua. Então, mamãe colocou água para esquentar, colocou a água na bacia e mandou que ele tomasse um banho. Depois, mamãe deu café com leite, batata doce assada, e biscoito na mesa, e chamou-o para comer. Nós nos sentamos à mesa junto com ele. Queríamos que ele falasse alguma coisa, mas ele ficava calado.<br><br>Foi então que mamãe perguntou a ele: "Por que é que você veio da Argentina sozinho? Quem são seus pais?". Ele não respondia nada, só ficava calado. De repente, aquele menino disse para minha mãe, com a voz um pouco enrolada: "Olha, tia, eu não tenho mãe. Quando ela morreu, eu era bebê. Meu pai me criou com a minha tia. Meu pai era muito mau, me batia muito e me castigava. Eu tinha que lavar as vasilhas todas sozinho, limpar o quintal. Eu não suportava mais aquela vida. Foi então que, um dia, depois que meu pai me bateu muito, ele foi dormir. De repente, eu senti uma raiva muito grande do meu pai, peguei um porrete e dei três golpes na cabeça dele. Aí eu saí correndo, porque fiquei com muito medo e arrependido. Eu não queria machucar meu pai. Estou muito triste. Tenho andado em vários lugares, mas as pessoas têm medo de mim. Eu não sou um menino mau, preciso de uma família para mim".<br><br>Então, minha mãe disse para ele que Jesus era o melhor amigo das crianças e que Ele iria cuidar dele.` },
            { id: 'acao', theme: 'licoes', title: 'Uma Boa Ação', content: `Então, mamãe pegou uma sacola, colocou roupas limpas e comida para ele levar na viagem. Também disse para ele: "Se você quiser, pode ficar aqui. Nós vamos para a igreja adorar ao Senhor Jesus. Se você for, Ele vai tirar a tristeza do seu coração e te fazer feliz. Também vai perdoar os teus pecados e te levar para o céu quando Ele voltar".<br><br>Aquela criança preferiu seguir viagem e foi embora. Mas nós fizemos uma boa ação.` },
            { id: 'anjo', theme: 'licoes', title: 'O Anjo Voando no Céu', content: `A história do anjo foi assim. Era dezembro e estava chovendo muito. Os campos estavam todos floridos, e os rios e lagoas, todos cheios. O pomar de frutas do vovô parecia um paraíso na Terra.<br><br>Amanheceu na fazenda, e o sol fazia reluzir seus raios, que entravam pelas frestas das portas e janelas. Mamãe já havia se levantado para fazer o café, tirar o leite das vacas e assar bolos e biscoitos. Enquanto isto, as crianças dormiam como anjos. Depois de tudo pronto, mamãe nos acordava para o café da manhã. Mas antes do café, mamãe nos alimentava com o Pão do Céu. Ah, vocês ficaram curiosos com o Pão do Céu? Vou contar-lhes o que é o Pão do Céu.<br><br>O Pão do Céu era um culto doméstico que mamãe fazia todas as manhãs com as crianças. Mariazinha, Zezinho, Florim, todos nós nos sentávamos em volta de uma mesa muito grande. Em cima da mesa, tinha café com leite, queijo, broa de fubá, biscoito de polvilho e broa. Mamãe pegava a Bíblia, lia ela para nós ouvirmos, depois explicava tudo o que ela leu, e nós ficávamos quietinhos, ouvindo mamãe. Depois, nós cantávamos lindos corinhos em louvor ao nome do Senhor.<br><br>Num destes cultos domésticos, mamãe ensinou sobre a volta de Jesus, e Mariazinha prestou muita atenção no que mamãe ensinava e ficou meditando naquele momento tão lindo. Depois, mamãe terminou o cultinho, nós tomamos o café e fomos brincar.<br><br>De repente, Mariazinha olha para o céu e vê um anjo muito lindo que passou pelo meio do céu tocando uma linda trombeta de ouro. Ela saiu correndo, chamando a mãe, e contou para ela. Mamãe ficou feliz e disse: "Quando Jesus voltar, este anjo vai vir com Ele e vai nos levar para o céu". Peça para a mamãe fazer o culto doméstico.` },
            { id: 'fragmentos', theme: 'final', title: 'Fragmentos', content: `<strong>Pedro Rita:</strong> Pedro Rita era um homem muito bom. Morava numa fazenda à beira da estrada. Tinha muitas moças; elas gostavam de lavar roupas no rio e também de tomar banho.<br><br><strong>A Menina da Porteira:</strong> À beira da estrada empoeirada, havia uma vendinha. Ali morava uma família muito especial. Sabe por quê? Porque todos serviam ao Senhor Jesus. Nesta família, tinha uma menina por nome Maria. Tinha apenas 6 anos e gostava muito de ver a boiada passar na estrada.` },
            { id: 'poemas', theme: 'final', title: 'Poemas e Canções', content: `<blockquote class="border-l-4 border-orange-800/50 pl-4 italic text-stone-600 mb-6">Planos que, embora fossem um sonho, se perderam.<br>Luto do que era certo, agora morreu.<br>Algemado por um peso, oh, quão triste eu andei,<br>Até sentir a mão de Cristo,<br>Não sou mais quem era, eu sei.<br>Tocou-me, Jesus, tocou-me,<br>De paz Ele encheu meu coração.<br>Quando o Senhor Jesus me tocou,<br>Livrou-me da escuridão.<br>Desde que aceitei a Cristo<br>E senti seu terno amor,<br>Tenho achado paz e vida,<br>Para sempre cantarei em Seu louvor.</blockquote><blockquote>Está escrito no Livro Santo:<br>"Ama teu próximo de coração."<br>Um certo dia, Cristo, olhando a multidão,<br>movido pelo amor, multiplicou o pão.<br>Queria que os homens vissem o sinal<br>de um Deus que tem poder real. Depois daqueles dias, muitos O deixaram, não era o Seu amor que os fazia estar seguindo aquela luz. Deixaram logo então Jesus.<br><br>Onde está Jesus? Onde opera a Sua mão? Muitos O seguem só na grande multidão, num templo conhecido ou na forma de louvar. São medidas que o homem dá. É hora de saber qual a sua posição, seguindo a Jesus, qual a maior motivação? Dinheiro, posição, talvez se o "eu" predominar, quem sabe a multidão se vá.</blockquote>` }
        ];

        let currentPage = 0;
        const totalPages = stories.length;
        const bookContainer = document.getElementById('book');
        const progressBar = document.getElementById('progress');
        
        let isDragging = false;
        let isScrolling = false;
        let startX = 0;
        let startY = 0;
        let currentDragPage = null;
        let currentDragDirection = null; 

        function initBook() {
            bookContainer.innerHTML = '';

            stories.forEach((story, index) => {
                const page = document.createElement('div');
                page.className = 'page';
                page.id = `page-${index}`;
                
                // Z-Index reverso
                page.style.zIndex = totalPages - index; 

                // --- Correção: Removida a lógica de visibility: hidden ---
                // Agora todas as páginas são renderizadas para evitar "buracos brancos"

                let contentHTML = '';
                let innerContent = '';

                if (story.type === 'cover') {
                    innerContent = `
                        <div class="flex flex-col items-center justify-center h-full">
                            <h1 class="title-fancy text-5xl md:text-6xl mb-4 text-orange-200 px-2 leading-tight">Gecy Maria</h1>
                            <div class="w-16 h-16 bg-white/20 rounded-full mx-auto mb-6 flex items-center justify-center">
                                <span class="text-3xl">✝</span>
                            </div>
                            <h2 class="text-xl md:text-2xl font-light tracking-widest uppercase mb-12">Autobiografia</h2>
                            <p class="mt-auto text-orange-200/80 text-sm animate-pulse">Arraste para abrir</p>
                        </div>
                    `;
                    contentHTML = `<div class="page-front capa">${innerContent}<div class="page-shadow"></div></div>`;
                } else if (story.type === 'index') {
                    let indexLinks = stories.slice(2).map((s, i) => 
                        `<li onclick="goToPage(${i + 2})" class="cursor-pointer hover:text-orange-800 border-b border-stone-200 py-3 flex justify-between items-center active:bg-stone-100 transition-colors">
                            <span class="truncate pr-4 text-stone-800">${s.title}</span> 
                            <span class="text-stone-400 text-xs whitespace-nowrap bg-stone-100 px-2 py-1 rounded-full">${i+1}</span>
                         </li>`
                    ).join('');
                    
                    innerContent = `
                        <h2 class="text-3xl font-bold text-center mb-6 text-orange-900 border-b-2 border-orange-900/20 pb-4">Índice</h2>
                        <ul class="space-y-1 text-base font-serif pb-10">
                            ${indexLinks}
                        </ul>
                    `;
                    contentHTML = `<div class="page-front text-stone-800"><div class="content-scroll">${innerContent}</div><div class="page-shadow"></div></div>`;
                } else {
                    innerContent = `
                        <h2 class="text-2xl md:text-3xl font-bold text-orange-900/90 mb-6 font-serif leading-tight">${story.title}</h2>
                        <div class="prose prose-stone prose-lg leading-relaxed text-justify pb-10">
                            ${story.content}
                        </div>
                        <div class="page-number">Página ${index - 1}</div>
                    `;
                    contentHTML = `<div class="page-front"><div class="content-scroll">${innerContent}</div><div class="page-shadow"></div></div>`;
                }

                const backHTML = `
                    <div class="page-back">
                        <div class="opacity-10 text-stone-500 text-6xl font-serif select-none">GM</div>
                    </div>
                `;

                page.innerHTML = contentHTML + backHTML;
                page.addEventListener('dragstart', e => e.preventDefault());
                bookContainer.appendChild(page);
            });

            updateButtons();
            setupInteractiveDrag();
        }

        function updateButtons() {
            const btnPrev = document.getElementById('btn-prev');
            const btnNext = document.getElementById('btn-next');
            const progress = (currentPage / (totalPages - 1)) * 100;
            progressBar.style.width = `${progress}%`;
            btnPrev.classList.toggle('btn-disabled', currentPage === 0);
            btnNext.classList.toggle('btn-disabled', currentPage >= totalPages - 1);
        }

        // Função de Download
        function downloadBook() {
            const htmlContent = document.documentElement.outerHTML;
            const blob = new Blob([htmlContent], { type: 'text/html' });
            const url = URL.createObjectURL(blob);
            const a = document.createElement('a');
            a.href = url;
            a.download = 'GecyMaria_Livro.html';
            document.body.appendChild(a);
            a.click();
            document.body.removeChild(a);
            URL.revokeObjectURL(url);
        }

        function finishFlip(targetIndex) {
            currentPage = targetIndex;
            updateButtons();
            
            for (let i = 0; i < totalPages; i++) {
                const p = document.getElementById(`page-${i}`);
                
                // Limpa estilos de drag
                p.style.transform = '';
                p.classList.remove('grabbing');
                p.classList.add('page-transition'); 

                // Estado final
                if (i < currentPage) {
                    p.style.transform = 'rotateY(-180deg)';
                    p.style.zIndex = i; 
                } else {
                    p.style.transform = 'rotateY(0deg)';
                    p.style.zIndex = totalPages - i;
                }

                const shadow = p.querySelector('.page-shadow');
                if(shadow) shadow.style.opacity = '0';
            }

            setTimeout(() => {
                document.querySelectorAll('.page').forEach(p => p.classList.remove('page-transition'));
            }, 600);
        }

        function setupInteractiveDrag() {
            const scene = document.getElementById('scene-container');
            const startEvents = ['mousedown', 'touchstart'];
            const moveEvents = ['mousemove', 'touchmove'];
            const endEvents = ['mouseup', 'touchend', 'mouseleave'];

            function getX(e) { return e.type.includes('mouse') ? e.pageX : e.touches[0].pageX; }
            function getY(e) { return e.type.includes('mouse') ? e.pageY : e.touches[0].pageY; }

            function onStart(e) {
                if (e.target.closest('button')) return;

                isDragging = false;
                isScrolling = false;
                startX = getX(e);
                startY = getY(e);
                
                const width = window.innerWidth;
                const isRightSide = startX > width / 2;

                if (isRightSide && currentPage < totalPages) {
                    currentDragPage = document.getElementById(`page-${currentPage}`);
                    currentDragDirection = 'next';
                } else if (!isRightSide && currentPage > 0) {
                    currentDragPage = document.getElementById(`page-${currentPage - 1}`);
                    currentDragDirection = 'prev';
                } else {
                    currentDragPage = null;
                }
            }

            function onMove(e) {
                if (isScrolling) return;

                const x = getX(e);
                const y = getY(e);
                const deltaX = x - startX;
                const deltaY = y - startY;

                if (!isDragging) {
                    if (Math.abs(deltaY) > Math.abs(deltaX) && Math.abs(deltaY) > 5) {
                        isScrolling = true;
                        return;
                    } 
                    else if (Math.abs(deltaX) > Math.abs(deltaY) && Math.abs(deltaX) > 5) {
                        isDragging = true;
                        if (currentDragPage) currentDragPage.classList.add('grabbing');
                    } else {
                        return; 
                    }
                }

                if (isDragging && currentDragPage) {
                    if (e.cancelable) e.preventDefault();

                    const screenW = window.innerWidth;
                    const bookW = screenW > 768 ? screenW / 2 : screenW;

                    let rotation = 0;
                    let opacityShadow = 0;

                    if (currentDragDirection === 'next') {
                        const progress = Math.min(0, Math.max(-bookW, deltaX)) / bookW;
                        rotation = progress * 180;
                        opacityShadow = Math.abs(progress) * 0.5;
                    } else {
                        const progress = Math.min(bookW, Math.max(0, deltaX)) / bookW;
                        rotation = -180 + (progress * 180);
                        opacityShadow = (1 - progress) * 0.5;
                    }

                    currentDragPage.style.transform = `rotateY(${rotation}deg)`;
                    
                    const shadow = currentDragPage.querySelector('.page-shadow');
                    if (shadow) shadow.style.opacity = opacityShadow;
                }
            }

            function onEnd(e) {
                if (!isDragging) return;
                isDragging = false;
                
                if (!currentDragPage) return;

                currentDragPage.classList.remove('grabbing');
                currentDragPage.classList.add('page-transition'); 

                const currentTransform = currentDragPage.style.transform;
                const rotationMatch = currentTransform.match(/rotateY\(([-\d.]+)deg\)/);
                let currentRot = rotationMatch ? parseFloat(rotationMatch[1]) : 0;

                if (currentDragDirection === 'next') {
                    if (currentRot < -30) {
                        finishFlip(currentPage + 1);
                    } else {
                        currentDragPage.style.transform = 'rotateY(0deg)';
                        const shadow = currentDragPage.querySelector('.page-shadow');
                        if(shadow) shadow.style.opacity = '0';
                    }
                } else {
                    if (currentRot > -150) {
                        finishFlip(currentPage - 1);
                    } else {
                        currentDragPage.style.transform = 'rotateY(-180deg)';
                        const shadow = currentDragPage.querySelector('.page-shadow');
                        if(shadow) shadow.style.opacity = '0';
                    }
                }
                currentDragPage = null;
            }

            startEvents.forEach(evt => scene.addEventListener(evt, onStart, { passive: false }));
            moveEvents.forEach(evt => window.addEventListener(evt, onMove, { passive: false }));
            endEvents.forEach(evt => window.addEventListener(evt, onEnd));
        }

        function nextPage() {
            if (currentPage < totalPages - 1) finishFlip(currentPage + 1);
        }
        function prevPage() {
            if (currentPage > 0) finishFlip(currentPage - 1);
        }
        window.goToPage = function(target) {
            finishFlip(target);
        }

        document.getElementById('btn-next').addEventListener('click', nextPage);
        document.getElementById('btn-prev').addEventListener('click', prevPage);
        document.addEventListener('keydown', (e) => {
            if (e.key === 'ArrowRight') nextPage();
            if (e.key === 'ArrowLeft') prevPage();
        });

        document.addEventListener('DOMContentLoaded', initBook);

    </script>
</body>
</html>
